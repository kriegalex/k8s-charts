# Deployment using external Kubernetes secret
# First create the secret:
#   kubectl create secret generic deltabadger-production-secrets \
#     --from-literal=SECRET_KEY_BASE=$(openssl rand -hex 64) \
#     --from-literal=DEVISE_SECRET_KEY=$(openssl rand -hex 64) \
#     --from-literal=APP_ENCRYPTION_KEY=$(openssl rand -hex 32)
#
# Then install with: helm install deltabadger ./deltabadger-helm -f examples/external-secrets-values.yaml

controllers:
  deltabadger:
    replicas: 1
    containers:
      app:
        env:
          APP_ROOT_URL: "https://deltabadger.example.com"
          HOME_PAGE_URL: "https://deltabadger.example.com"
          FORCE_SSL: "true"
        # Use external secret instead of chart-managed secret
        envFrom:
          - secretRef:
              name: deltabadger-production-secrets

persistence:
  storage:
    enabled: true
    size: 20Gi

ingress:
  app:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      # Backend protocol - Tell NGINX to use HTTP (not HTTPS) for backend
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    hosts:
      - host: deltabadger.example.com
        paths:
          - path: /
            pathType: Prefix
            service:
              identifier: app
              port: http
    tls:
      - secretName: deltabadger-tls
        hosts:
          - deltabadger.example.com

# Disable chart-managed secrets when using external secret
secrets:
  secrets:
    enabled: false
